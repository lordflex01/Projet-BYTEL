{% extends 'header.html.twig' %}
{% block javascripts %}
	<!-- jQuery -->
	<script src="{{asset ("assets/plugins/jquery/jquery.min.js")}}"></script>
	<!-- Bootstrap 4 -->
	<script src="{{asset ("assets/plugins/bootstrap/js/bootstrap.js")}}"></script>
	<!-- overlayScrollbars -->
	<script src="{{asset ("assets/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js")}}"></script>
	<script src="{{asset ("assets/js/AdminLTE.js")}}"></script>
	<!-- OPTIONAL SCRIPTS -->
	<script src="{{asset ("assets/plugins/chart.js/Chart.min.js")}}"></script>
	<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
	<script src="{{asset ("assets/js/pages/dashboard3.js")}}"></script>
	<script src="{{asset ("assets/js/impCal/lib/main.js")}}"></script>
	<script src="{{asset ("assets/js/calendar/moment.min.js")}}"></script>

	<script>

		document.addEventListener('DOMContentLoaded', function () {
var calendarEl = document.getElementById('calendar');

var calendar = new FullCalendar.Calendar(calendarEl, {

// eventClick: function (info) {
// alert(info.event.title + "\n\n\n\nModifier cette imputation:");
// info.el.style.borderColor = 'red';
// },
select: function (start, end) {
$('#ModalAdd #start').val(moment(start).format('YYYY-MM-DD HH:mm:ss'));
$('#ModalAdd #end').val(moment(end).format('YYYY-MM-DD HH:mm:ss'));
$('#ModalAdd').modal('show');
},
locale: "fr",
editable: true, // enable draggable events
selectable: true,
selectHelper: true,
aspectRatio: 1.8,
headerToolbar: {
left: 'today prev,next',
center: 'title',
right: 'resourceTimelineDay,timeGridWeek,dayGridMonth,listWeek'
},
initialView: 'resourceTimelineDay',
resourceAreaHeaderContent: 'Collaborateurs',
eventResizableFromStart: true,
resources: {{ uses | raw }},
eventClick: function (event, element) {
$('#ModalEdit #id').val(event.id);
$('#ModalEdit #title').val(event.title);
$('#ModalEdit #color').val(event.color);
$('#ModalEdit').modal('show');
},
events: {{ datas | raw }}
});
calendar.on('eventChange', (e) => {
let url = `/api/${
e.event.id
}/edit`
let donnees = {
"title": e.event.title,
"start": e.event.start,
"end": e.event.end
}
let xhr = new XMLHttpRequest
xhr.open("PUT", url)
xhr.send(JSON.stringify(donnees))
})

calendar.render();
});
	</script>
{% endblock %}
{% block body %}
	<!--{{ dump(datas) }}-->
	<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper"> <!-- Content Header (Page header) -->
		<!-- Content Header (Page header) -->
			<section class="content-header"> <div class="container-fluid">
				<div class="row mb-2">
					<div class="col-sm-6">
						<h1 class="m-0" style="font-size:19px">Imputation</h1>
					</div>
					<div class="col-sm-6">
						<ol class="breadcrumb float-sm-right">
							<li class="breadcrumb-item">
								<a href="/index">Accueil</a>
							</li>
							<li class="breadcrumb-item active">Imputation</li>
						</ol>
					</div>
					<div style="float:right;">
						<a style="float:right;" class="btn btn-primary" href="{{ path('imputation_new') }}">Faire une imputation</a>
					</div>
				</div>
			</div>
			<!-- /.container-fluid -->

			<!-- /////////////////////////////DEBUT historique/////////////////////////// -->
			<!-- /////////////////////////////DEBUT historique/////////////////////////// -->
			<!-- Content Wrapper. Contains page content -->


			<!-- Main content -->
				<section class="content"> <div class="card">
					<div class="card-body" id='calendar'></div>
					<!-- Modal -->
					<div class="modal fade" id="ModalEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<form class="form-horizontal" method="POST" action="editEventTitle.php">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
										<h4 class="modal-title" id="myModalLabel">Edit Event</h4>
									</div>
									<div class="modal-body">

										<div class="form-group">
											<label for="title" class="col-sm-2 control-label">Title</label>
											<div class="col-sm-10">
												<input type="text" name="title" class="form-control" id="title" placeholder="Title">
											</div>
										</div>
										<div class="form-group">
											<label for="color" class="col-sm-2 control-label">Color</label>
											<div class="col-sm-10">
												<select name="color" class="form-control" id="color">
													<option value="">Choose</option>
													<option style="color:#0071c5;" value="#0071c5">&#9724; Dark blue</option>
													<option style="color:#40E0D0;" value="#40E0D0">&#9724; Turquoise</option>
													<option style="color:#008000;" value="#008000">&#9724; Green</option>
													<option style="color:#FFD700;" value="#FFD700">&#9724; Yellow</option>
													<option style="color:#FF8C00;" value="#FF8C00">&#9724; Orange</option>
													<option style="color:#FF0000;" value="#FF0000">&#9724; Red</option>
													<option style="color:#000;" value="#000">&#9724; Black</option>

												</select>
											</div>
										</div>
										<div class="form-group">
											<div class="col-sm-offset-2 col-sm-10">
												<div class="checkbox">
													<label class="text-danger"><input type="checkbox" name="delete">
														Delete event</label>
												</div>
											</div>
										</div>

										<input type="hidden" name="id" class="form-control" id="id">


									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
										<button type="submit" class="btn btn-primary">Save changes</button>
									</div>
								</form>
							</div>
						</div>
					</div>

					<!-- Modal -->
					<div class="modal fade" id="ModalAdd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<form class="form-horizontal" method="POST" action="addEvent.php">

									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
										<h4 class="modal-title" id="myModalLabel">Add Event</h4>
									</div>
									<div class="modal-body">

										<div class="form-group">
											<label for="title" class="col-sm-2 control-label">Title</label>
											<div class="col-sm-10">
												<input type="text" name="title" class="form-control" id="title" placeholder="Title">
											</div>
										</div>
										<div class="form-group">
											<label for="color" class="col-sm-2 control-label">Color</label>
											<div class="col-sm-10">
												<select name="color" class="form-control" id="color">
													<option value="">Choose</option>
													<option style="color:#0071c5;" value="#0071c5">&#9724; Dark blue</option>
													<option style="color:#40E0D0;" value="#40E0D0">&#9724; Turquoise</option>
													<option style="color:#008000;" value="#008000">&#9724; Green</option>
													<option style="color:#FFD700;" value="#FFD700">&#9724; Yellow</option>
													<option style="color:#FF8C00;" value="#FF8C00">&#9724; Orange</option>
													<option style="color:#FF0000;" value="#FF0000">&#9724; Red</option>
													<option style="color:#000;" value="#000">&#9724; Black</option>

												</select>
											</div>
										</div>
										<div class="form-group">
											<label for="start" class="col-sm-2 control-label">Start date</label>
											<div class="col-sm-10">
												<input type="text" name="start" class="form-control" id="start" readonly>
											</div>
										</div>
										<div class="form-group">
											<label for="end" class="col-sm-2 control-label">End date</label>
											<div class="col-sm-10">
												<input type="text" name="end" class="form-control" id="end" readonly>
											</div>
										</div>

									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
										<button type="submit" class="btn btn-primary">Save changes</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>

				<div
					class="container-fluid">
					<!-- Timelime example  -->
					<div class="row">
						<div
							class="col-md-12">
							<!-- The time line -->
							<div class="timeline">
								{% if app.user.roles == ["ROLE_USER"] %}
									{% for imputation in imputations %}
										{% if app.user.id == imputation.user.id %}
											<!-- timeline time label -->
											<div class="time-label">
												<span class="bg-green">{{ imputation.dateD ? imputation.dateD|format_datetime('full', 'none', locale='fr')}}</span>
											</div>
											<!-- /.timeline-label -->
											<!-- timeline item -->
											<div>
												<!--<i class="fas fa-user {{ random(['bg-green', 'bg-blue', 'bg-purple']) }}"></i>-->
												<i class="fas fa-user bg-purple"></i>
												<div class="timeline-item">
													<span class="time">
														<i class="fas fa-clock"></i>
														{{ imputation.time|format_datetime('long', 'short', locale='fr') }}</span>
													<h3 class="timeline-header">
														<a href="#">{{ imputation.user.username }}</a>
														{{ imputation.codeprojet.libelle }}
														:
														{{ imputation.codeprojet.description }}</h3>

													<div class="timeline-body">
														{{ imputation.commentaire }}
													</div>
													<div class="timeline-footer">
														<a class="btn btn-info btn-sm" href="{{ path('imputation_edit', {'id': imputation.id}) }}">
															<i class="fas fa-pencil-alt"></i>
														</a>
														<a class="btn">
															{{ include('imputation/_delete_form.html.twig') }}
														</a>
													</div>
												</div>
											</div>
											<!-- END timeline item -->
											<!-- timeline time label -->
											<div class="time-label">
												<span class="bg-red">{{ imputation.dateF ? imputation.dateF|format_datetime('long', 'none', locale='fr')}}</span>
											</div>
										{% endif %}
									{% else %}
										<tr>
											<td colspan="5">Aucune imputation trouvé</td>
										</tr>
									{% endfor %}
								{% else %}
									{% for imputation in imputations %}
										<!-- timeline time label -->
										<div class="time-label">
											<span class="bg-green">{{ imputation.dateD ? imputation.dateD|format_datetime('full', 'none', locale='fr') }}</span>
										</div>
										<!-- /.timeline-label -->
										<!-- timeline item -->
										<div>
											<!--<i class="fas fa-user {{ random(['bg-green', 'bg-blue', 'bg-purple']) }}"></i>-->
											<i class="fas fa-user bg-purple"></i>
											<div class="timeline-item">
												<span class="time">
													<i class="fas fa-clock"></i>
													{{ imputation.time|format_datetime('long', 'short', locale='fr') }}</span>
												<h3 class="timeline-header">
													<a href="#">{{ imputation.user.username }}</a>
													[{{ imputation.codeprojet.projet.libelle }}]
													{{ imputation.codeprojet.libelle }}
													:
													{{ imputation.codeprojet.description }}</h3>

												<div class="timeline-body">
													{{ imputation.commentaire }}
												</div>

												<div class="timeline-footer">
													<a class="btn btn-info btn-sm" href="{{ path('imputation_edit', {'id': imputation.id}) }}">
														<i class="fas fa-pencil-alt"></i>
													</a>
													<a class="btn">
														{{ include('imputation/_delete_form.html.twig') }}
													</a>
												</div>

											</div>
										</div>
										<!-- END timeline item -->
										<!-- timeline time label -->
										<div class="time-label">
											<span class="bg-red">{{ imputation.dateF ? imputation.dateF|format_datetime('long', 'none', locale='fr')}}</span>
										</div>
									{% else %}
										<tr>
											<td colspan="5">Aucune imputation trouvé</td>
										</tr>
									{% endfor %}
									<div>
										<i class="fas fa-clock bg-gray"></i>
									</div>
								{% endif %}
								<!-- /.timeline-label -->

							</div>
						</div>
						<!-- /.col -->
					</div>
				</div>
				<!-- /.timeline -->
			</section>
			<!-- /.content -->

			<!-- /.content-wrapper -->
		{% endblock %}
